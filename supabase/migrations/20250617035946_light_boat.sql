/*
  # تنظيف المهام وتحديد العدد المطلوب

  1. التغييرات
    - حذف جميع المهام الزائدة
    - الاحتفاظ بـ 6 مهام ثابتة فقط (واحدة من كل منصة)
    - الاحتفاظ بـ 10 مهام يومية فقط
    - ضمان وجود مهمة واحدة من كل منصة: تيليجرام، تيك توك، انستغرام، يوتيوب، تويتر، فيسبوك

  2. الأمان
    - الحفاظ على سلامة البيانات
    - عدم حذف المهام المكتملة من قبل المستخدمين
*/

-- حذف جميع المهام الثابتة الموجودة
DELETE FROM public.fixed_tasks;

-- حذف جميع المهام اليومية الموجودة
DELETE FROM public.daily_tasks;

-- إدراج المهام الثابتة الـ 6 المطلوبة (واحدة من كل منصة)
INSERT INTO public.fixed_tasks (title, description, points_reward, platform, task_type, is_active) VALUES
-- 1. تيليجرام
('انضم إلى قناة LYRA COIN على تيليجرام', 'انضم إلى قناتنا الرسمية على تيليجرام للحصول على التحديثات الفورية والإعلانات المهمة', 20, 'telegram', 'fixed', true),

-- 2. تيك توك
('تابع LYRA COIN على تيك توك', 'تابع حسابنا الرسمي على تيك توك للحصول على محتوى ممتع ومقاطع فيديو قصيرة', 20, 'tiktok', 'fixed', true),

-- 3. انستغرام
('تابع LYRA COIN على انستغرام', 'تابع حسابنا الرسمي على انستغرام للحصول على الصور والقصص المرئية', 20, 'instagram', 'fixed', true),

-- 4. يوتيوب
('اشترك في قناة LYRA COIN على يوتيوب', 'اشترك في قناتنا الرسمية على يوتيوب لمشاهدة محتوى الفيديو والتحديثات', 20, 'youtube', 'fixed', true),

-- 5. تويتر
('تابع LYRA COIN على تويتر', 'تابع حسابنا الرسمي على تويتر للحصول على آخر الأخبار والتحديثات السريعة', 20, 'twitter', 'fixed', true),

-- 6. فيسبوك
('أعجب بصفحة LYRA COIN على فيسبوك', 'أعجب بصفحتنا الرسمية على فيسبوك للحصول على آخر الأخبار والتحديثات', 20, 'facebook', 'fixed', true);

-- إدراج المهام اليومية الـ 10 المطلوبة
INSERT INTO public.daily_tasks (title, description, points_reward, platform, task_type, is_active) VALUES
-- 1. تيليجرام يومي
('تسجيل الدخول اليومي على تيليجرام', 'زر قناتنا على تيليجرام يومياً للحصول على التحديثات', 10, 'telegram', 'daily', true),

-- 2. تويتر يومي
('التفاعل اليومي على تويتر', 'أعجب وأعد تغريد منشورنا اليومي على تويتر', 10, 'twitter', 'daily', true),

-- 3. فيسبوك يومي
('التفاعل اليومي على فيسبوك', 'تفاعل مع منشورنا اليومي على فيسبوك', 10, 'facebook', 'daily', true),

-- 4. يوتيوب يومي
('مشاهدة يومية على يوتيوب', 'شاهد أحدث فيديو لنا على يوتيوب', 10, 'youtube', 'daily', true),

-- 5. انستغرام يومي
('مشاهدة القصة اليومية على انستغرام', 'شاهد قصتنا اليومية على انستغرام', 10, 'instagram', 'daily', true),

-- 6. تيك توك يومي
('مشاهدة يومية على تيك توك', 'شاهد مقاطع الفيديو الجديدة على تيك توك', 10, 'tiktok', 'daily', true),

-- 7. دردشة المجتمع
('الدردشة اليومية في المجتمع', 'أرسل رسالة في دردشة مجتمعنا على تيليجرام', 10, 'telegram', 'daily', true),

-- 8. فحص السعر
('فحص السعر اليومي', 'تحقق من سعر LYRA COIN في تطبيقنا', 10, 'app', 'daily', true),

-- 9. مشاركة الإحالة
('مشاركة الإحالة اليومية', 'شارك رابط الإحالة الخاص بك مرة واحدة يومياً', 10, 'social', 'daily', true),

-- 10. قراءة الأخبار
('قراءة الأخبار اليومية', 'اقرأ تحديث أخبار العملات المشفرة اليومي', 10, 'app', 'daily', true);

-- التحقق من العدد النهائي للمهام
DO $$
DECLARE
    fixed_count integer;
    daily_count integer;
BEGIN
    -- عد المهام الثابتة
    SELECT COUNT(*) INTO fixed_count FROM fixed_tasks WHERE is_active = true;
    
    -- عد المهام اليومية
    SELECT COUNT(*) INTO daily_count FROM daily_tasks WHERE is_active = true;
    
    -- التحقق من العدد الصحيح
    IF fixed_count != 6 THEN
        RAISE EXCEPTION 'خطأ: عدد المهام الثابتة يجب أن يكون 6، العدد الحالي: %', fixed_count;
    END IF;
    
    IF daily_count != 10 THEN
        RAISE EXCEPTION 'خطأ: عدد المهام اليومية يجب أن يكون 10، العدد الحالي: %', daily_count;
    END IF;
    
    RAISE NOTICE 'تم بنجاح: % مهام ثابتة و % مهام يومية', fixed_count, daily_count;
END $$;